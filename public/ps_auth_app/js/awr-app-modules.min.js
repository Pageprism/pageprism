!function(window,$){"use strict";window.awr=window.awr||{},window.awr.bootQueue=window.awr.bootQueue||[];var console=window.console;function $export(path,exp,opts){opts=opts||{takeEasy:!0,appExport:!0};let sta=window.awr.$static,q=window.awr.Q;return opts.appExport=!0,opts.takeEasy=!q.$booleanFalse(opts.takeEasy),sta.$export(path,exp,opts)}function $import(ref){return window.awr.$static.$import(ref)}function $emit(eventStr,event){return window.awr.$static.$emit(eventStr,event)}function __onModuleBootTimeoutError__(err){window.console.error("initModule@APP@AWR: Failed to instantiate app module. \n\t + Details: Init process interrupted by timeout. \n\t + Hint: Required components were not ready  before maximum wait time."),window.console.error(err)}function __callModuleMainFn__(mainFn,requires){try{"function"==typeof mainFn&&(!function(requires){return window.awr.Q.$arrayNotEmpty(requires)||window.awr.Q.$objectExist(requires)}(requires)?mainFn.call(window.awr.Q):window.awr.Q.$commonWaitAndProceedOperation(requires,function(){mainFn.call(window.awr.Q)},3e3,__onModuleBootTimeoutError__))}catch(e){console.error(e)}}function __pushToBootQueue__(init){window.awr.bootQueue.push({moduleName:"basicAppModule@AWR",requires:["object:awr.$$appEssentials","object:awr.coreTemplate","object:awr.ux"],wTime:36e5,init:init,QAsContext:!0})}!function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class App extends awr.Controller{static get $require(){return{bootRoutines:"service:appBootRoutines",globalFunctions:"service:globalFunctions",remoteConfig:"config:remoteConnection",router:"service:router",modal:"service:modal",socket:"observable:socket"}}constructor(parent,data){super(App.$require,parent,data);let{bootRoutines:bootRoutines,globalFunctions:globalFunctions,router:router,modal:modal,socket:socket,docEvents:docEvents}=this,scope=this;this.$disableDefaultActionAutoRecompile(),bootRoutines.init(this),globalFunctions.attach(this),scope.$bind("observable:notFound@states@router",{onEvent(event,preventDefault){preventDefault(),event.preventDefault(),$emit("collection:events",{name:"new-doc-selected",doc:null}),router.$go("errors-view",{params:{code:"404"},attrs:{}},!0)}}),scope.$bind("observable:authEvents",{onEvent(event,preventDefault){preventDefault(),!Q.$booleanTrue(scope.reloading)&&Q.$objectExist(event)&&(Q.$setContainsString(["sign-in","sign-out"],event.type)&&bootRoutines.setupCurrentUser(scope),scope.reloading=!0,setTimeout(_=>{scope.reloading=!1},1e3))}})}openPrivacyPolicy(){let{modal:modal}=this;modal.$enter("privacyPolicyModal",{modalClass:"privacy-policy-parent"})}}$export(App),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class PassResetKeyCheck extends awr.Resolvable{static get $require(){return{server:"service:serverCall",remoteCnf:"config:remoteConnection"}}constructor(){super(PassResetKeyCheck.$require)}resolve(state){let{server:server,remoteCnf:remoteCnf}=this;return new Promise((resolve,reject)=>{server.$post({url:`${remoteCnf.serverURL}/xauth/check_password_reset_key`,data:{key:state.params.key}}).then(res=>{resolve(!0)},err=>{resolve(!1)})})}}$export(PassResetKeyCheck),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class AppBootRoutines extends awr.Service{static get $require(){return{modelManager:"service:modelManager",remoteConfig:"config:remoteConnection",socketClient:"service:socketClient",scrollDirection:"service:scrollDirection"}}constructor(){super(AppBootRoutines.$require)}init(scope){let{modelManager:modelManager,remoteConfig:remoteConfig,socketClient:socketClient,scrollDirection:scrollDirection}=this;!function(scope,modelManager,remoteConfig,socketClient,scrollDirection){let globalHeaders={accept:"application/json","content-type":"application/json"};Object.defineProperty(globalHeaders,"authorization",{get:()=>$import(`token:awr_app_token @decoder: base64:${remoteConfig.decoder}`)}),scope.serverURL=remoteConfig.serverURL,scope.appName="ps_auth_app",modelManager.$setGlobalPrefix(remoteConfig.apiURL),modelManager.$setGlobalHeaders(globalHeaders),scope.setCleanUserPictureSrc=(user=>{user&&Q.$stringExist(user.picture)&&user.picture.startsWith("/")&&(user.picture=`${scope.serverURL}${user.picture}`)}),setupCurrentUser(scope,remoteConfig,socketClient),function(scope){$(window).on("scroll",function(){}),$(window.document).on("click",function(event){let onMenu=$(scope.$getDom()).find(".main-menu-expand.on"),mainMenuToggle=$(scope.$getDom()).find(".main-menu.menu-toggle"),onUserMenu=$(scope.$getDom()).find(".user-menu-expand.on"),openPageMenus=$(scope.$getDom()).find(".doc-page .page-menu.on"),openDocMenu=$(scope.$getDom()).find(".ps-header.doc-menu-open"),docPageActions=$(scope.$getDom()).find(".doc-page .tools .left-actions"),tagsSection=$(scope.$getDom()).find(".tags-section"),target=event.target;Q.$isEmpty($(target).closest(".main-menu-expand, .main-menu"))&&$(onMenu).animate({width:"hide"},165,function(){$(onMenu).removeClass("on"),$(mainMenuToggle).removeClass("open")}),Q.$isEmpty($(target).closest(".user-menu-expand, .user-menu"))&&$(onUserMenu).animate({height:"hide"},165,function(){$(onUserMenu).removeClass("on")}),Q.$isEmpty($(target).closest(".tags-section .tag-search, .tag-subscription.search-suggestion"))?$(tagsSection).removeClass("in-search"):Q.$isEmpty(tagsSection)||$(tagsSection).addClass("in-search"),Q.$isEmpty($(target).closest(".doc-page .page-menu"))&&$(openPageMenus).removeClass("on"),Q.$isEmpty($(target).closest(".doc-page"))&&$(docPageActions).removeClass("on"),Q.$isEmpty($(target).closest(".ps-header .doc-menu, .ps-header .doc-menu-toggle "))&&$(scope.$getDom()).find(".ps-header .doc-menu").animate({height:"hide"},165,function(){$(openDocMenu).removeClass("doc-menu-open")})})}(scope),scrollDirection.start($import("object:awr.superScope"))}(scope,modelManager,remoteConfig,socketClient,scrollDirection)}setupCurrentUser(scope){let{remoteConfig:remoteConfig,socketClient:socketClient}=this;console.log(remoteConfig),setupCurrentUser(scope,remoteConfig,socketClient)}}function setupCurrentUser(scope,remoteConfig,socketClient){Q.$objectExist(remoteConfig.user)&&Q.$booleanFalse(remoteConfig.isGuest)?(scope.currentUser=remoteConfig.user,scope.currentNickname=Q.$stringExist(scope.currentUser.name)?scope.currentUser.name.split(" ")[0]:"anonymous",scope.isCurrentAdmin=!!Q.$arrayNotEmpty(scope.currentUser.roles)&&Q.$reduce(scope.currentUser.roles,nxt=>"moderator"===nxt.name).length>0,Q.$functionExist(scope.setCleanUserPictureSrc)&&scope.setCleanUserPictureSrc(scope.currentUser),socketClient.connect()):(socketClient.disconnect(),scope.isGuest=!0,scope.currentUser=null)}$export(AppBootRoutines),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;$import("window:jQuery");class AuthRedirector extends awr.Service{static get $require(){return{router:"service:router",remoteCnf:"config:remoteConnection",tokenExchange:"service:tokenExchange",base64:"service:uriBase64"}}constructor(){super(AuthRedirector.$require),Object.defineProperty(this,"superScope",{get:()=>$import("object:awr.superScope")})}makeExternalRedirectURL(next){let itType,longSavedSessionToken,{router:router,remoteCnf:remoteCnf,tokenExchange:tokenExchange,superScope:superScope,base64:base64}=this;return Q.$stringExist(next)?(next=function(next){let parts=next.split("?");if(parts.length<2||2===parts.length&&!Q.$stringExist(parts[1]))return parts[0]+"?";if(parts.length>1&&!parts[1].endsWith("&"))return parts[0]+"?"+parts[1]+"&";if(parts.length>1)return parts[0]+"?"+parts[1];return null}(next),longSavedSessionToken=localStorage.getItem("awr_app_token"),itType=Q.$stringExist(longSavedSessionToken)&&!Q.$stringEqual(longSavedSessionToken,"null")?"long":"short",new Promise((resolve,reject)=>{tokenExchange.make().then(exchange=>{resolve(`${next}it_type=${itType}&it=${base64.encode(exchange.key)}`)},err=>{console.error(err),reject(`${next}it_type=none&it=none`)})})):Promise.reject("bad next")}redirect(next){let appNext,{router:router,remoteCnf:remoteCnf,tokenExchange:tokenExchange,superScope:superScope,base64:base64}=this;Q.$stringExist(next)&&((Q.$stringEqual(next,"default")||next.startsWith("#")||next.startsWith("/#"))&&(appNext="/#v/no_title/none/index?c=index",next=`${remoteCnf.serverURL}/#in/v/no_title/none?c=index&it_next=${base64.encode(appNext)}`),this.makeExternalRedirectURL(next).then(url=>{window.location=url},defaultUrl=>{window.location=defaultUrl}))}exit(next){let{router:router,remoteCnf:remoteCnf,tokenExchange:tokenExchange,superScope:superScope,base64:base64}=this;if(Q.$stringExist(next))return next.startsWith("#")||next.startsWith("/#")?(next=next.startsWith("/#")?next:`/${next}`,void router.$pushStateLink(next)):void(Q.$stringEqual(next,"default")?router.$go("default",{attrs:{view:"index"}}):window.location=next)}}$export(AuthRedirector),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class Auth extends awr.Service{static get $require(){return{remoteConnCnf:"config:remoteConnection",server:"service:serverCall",tokenSvc:"service:token"}}constructor(){super(Auth.$require)}register(data){let{remoteConnCnf:remoteConnCnf,server:server,tokenSvc:tokenSvc}=this;return server.$post({url:`${remoteConnCnf.authURL}/user`,data:data})}signOut(){let{remoteConnCnf:remoteConnCnf,server:server,tokenSvc:tokenSvc}=this,token=$import(`token:awr_app_token @decoder: base64:${remoteConnCnf.decoder}`);return $export("token:awr_app_token",null),$export("token:awr_exchange_token",null),remoteConnCnf.user=null,remoteConnCnf.isGuest=!0,$emit("auth:events",{type:"sign-out"}),new Promise((resolve,reject)=>{tokenSvc.destroyToken(token).then(res=>{setTimeout(_=>{resolve("success")},250)},err=>{console.error(err),setTimeout(_=>{resolve(`failed ${err}`)},250)})})}signIn({email:email,password:password,remember:remember=!1}){let token,exchangeToken,{remoteConnCnf:remoteConnCnf,server:server,tokenSvc:tokenSvc}=this,encoder=remoteConnCnf.encoder,trustVal="";return Q.$stringExist(email)?Q.$stringExist(password)?(Q.$booleanTrue(remember)&&(trustVal="@remember"),new Promise((resolve,reject)=>{tokenSvc.getNewAccessToken(email,password).then(tokenResult=>{tokenResult.token_type=Q.$stringExist(tokenResult.token_type)?tokenResult.token_type:"Bearer",token=`${tokenResult.token_type} ${tokenResult.access_token}`,exchangeToken=tokenResult.exchange,$export("token:awr_app_token",`${token} ${trustVal} @encoder: base64:${encoder}`),Q.$stringExist(exchangeToken)&&$export("token:awr_exchange_token",`${exchangeToken} @encoder: base64:${encoder}`),tokenSvc.getTokenUser(token).then(userResult=>{remoteConnCnf.user=userResult,remoteConnCnf.isGuest=!1,$emit("auth:events",{type:"sign-in",user:userResult}),resolve(userResult)},err=>{err.responseJSON&&(err=(err=err.responseJSON).message?err.message:err),reject(err)})},err=>{err.responseJSON&&(err=(err=err.responseJSON).message?function(msg){if(msg&&msg.indexOf("The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed.")>=0)return"Authorization failed due to missing / bad required email and password fields";return msg}(err.message):err),reject(err)})})):Promise.reject("Password is required!"):Promise.reject("Email is required!")}}$export(Auth),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,modalEnterTime=($import("window:jQuery"),0);class GlobalFunctions extends awr.Service{static get $require(){return{remoteConfig:"config:remoteConnection",router:"service:router",base64:"service:uriBase64",modal:"service:modal",collectionFetcher:"service:collectionFetcher",helper:"service:globalFnHelper"}}constructor(){super(GlobalFunctions.$require)}attach(scope){!function(scope,svcContext){let{remoteConfig:remoteConfig,router:router,base64:base64,modal:modal,collectionFetcher:collectionFetcher,helper:helper}=svcContext,hashPrefix=remoteConfig.isDevPort?"/#":"/";scope.isCollectionMyShelf=(collId=>{Q.$functionExist(scope.$preventDefault)&&scope.$preventDefault();let currentUser=scope.currentUser;return currentUser.main_series=currentUser&&!Q.$isEmpty(currentUser.main_series)?Q.$asCollection(currentUser.main_series):Q.$asCollection([]),currentUser.main_series.$count(nxt=>"my_shelf"===nxt.type&&nxt.series_id==collId)>0}),scope.$fn({scrollToTop(){scope.$preventDefault(),window.scrollTo(0,0)},redirectToAuth(view){scope.$preventDefault();let state=router.$getCurrentState(),next=state.attrs&&Q.$stringExist(state.attrs.next)?state.attrs.next:"default";view=Q.$stringExist(view)&&"signUp"===view?"signup":"default","default"===state.name&&view===state.attrs.view||router.$go("default",{params:{},attrs:{next:next,view:view}},!0)},forgotPassword(){scope.$preventDefault(),router.$go("forgot-password-view",{params:{},attrs:{}},!0)},signOut(){scope.$preventDefault(),router.$destroyAuthSession({connectionConfig:$import("config:remoteConnection"),onEnterBusyMode(msg){(new Date).getTime();modalEnterTime=(new Date).getTime()+1e3,modal.$enter("smallNotifModal",{icon:"fas fa-circle-notch fa-spin",message:msg})},onExitBusyMode(){let now=(new Date).getTime();setTimeout(_=>{modal.$exit()},now<modalEnterTime?500:0),setTimeout(_=>{router.$reloadCurrentState()},500)}})},openMyShelf(){scope.$preventDefault();let pivot=null;this.currentUser&&!Q.$isEmpty(this.currentUser.main_series)&&(pivot=Q.$asCollection(this.currentUser.main_series).$reduce(nxt=>"my_shelf"===nxt.type).$first()),Q.$objectExist(pivot)?this.openCollection(pivot.series_id):modal.$enter("smallNotifModal",{icon:"fa fa-exclamation-triangle text-warning",message:"My Shelf is not available. Please set your main collection first.",showRemove:!0})},openCollection(collId){scope.$preventDefault();let current,link,currentUser=scope.currentUser;current=collectionFetcher.getCurrent(),Q.$exist(collId)&&(!Q.$objectExist(currentUser)||currentUser.is_email_confirmed?helper.firstDocDataInCollection(collId).then(data=>{link=`${remoteConfig.serverURL}${hashPrefix}v/${data.docTitle}/${data.docId}?c=index`,window.location=link},err=>{Q.$stringExist(err)&&"empty"===err?(console.error("Collection is empty"),link=`${remoteConfig.serverURL}${hashPrefix}errors/e1`,window.location=link):(console.error("PS: Failed to open collection"),console.error(err))}):modal.$enter("smallNotifModal",{icon:"fa fa-exclamation-triangle text-warning",message:"Please confirm your email first.",showRemove:!0}))},openMyCollections(){scope.$preventDefault();let{remoteConfig:remoteConfig}=this,currentUser=scope.currentUser;!Q.$objectExist(currentUser)||currentUser.is_email_confirmed?window.location=`${remoteConfig.serverURL}${hashPrefix}my_collections/index`:modal.$enter("smallNotifModal",{icon:"fa fa-exclamation-triangle text-warning",message:"Please confirm your email first.",showRemove:!0})},openControls(){scope.$preventDefault();let{remoteConfig:remoteConfig}=this,currentUser=scope.currentUser;!Q.$objectExist(currentUser)||currentUser.is_email_confirmed?window.location=`${remoteConfig.serverURL}${hashPrefix}controls/bookmarks`:modal.$enter("smallNotifModal",{icon:"fa fa-exclamation-triangle text-warning",message:"Please confirm your email first.",showRemove:!0})},openPrinciples(){scope.$preventDefault(),helper.findPrinciplesCollId().then(id=>{this.openCollection(id)},err=>{console.error(err)})}})}(scope,this)}}$export(GlobalFunctions),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class TokenExchange extends awr.Service{static get $require(){return{server:"service:serverCall",remoteCnf:"config:remoteConnectionConfig"}}constructor(){super(TokenExchange.$require)}make(){let it,appGroup,{server:server,remoteCnf:remoteCnf}=this;return it=$import(`token:awr_exchange_token @decoder: base64:${remoteCnf.decoder}`),$export("token:awr_exchange_token",null),Q.$stringExist(it)?Promise.resolve({key:it,expires:"never"}):(appGroup=$('meta[name="awr-app-group"]').first(),server.$post({url:`${remoteCnf.authURL}/make_exchange`,headers:{authorization:$import(`token:awr_app_token @decoder: base64:${remoteCnf.decoder}`)},data:{app_group:Q.$arrayNotEmpty(appGroup)?$(appGroup).attr("content"):"default"}}))}}$export(TokenExchange),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class AcceptTerms extends awr.Validator{static get $require(){return{}}constructor(){super(AcceptTerms.$require)}isValid(val,elem){return Q.$booleanTrue(val)||1===parseInt(val)}}$export(AcceptTerms),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class OptionalPhone extends awr.Validator{static get $require(){return{validator:"validator:phone"}}constructor(){super(OptionalPhone.$require)}isValid(val,elem){let{validator:validator}=this;return!Q.$stringExist(val)||validator.isValid(val,elem)}}$export(OptionalPhone),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){(window.awr||{}).Q;$export("component:passStrength",{requires:[],template:"app/components/pass-strength/pass-strength.hbs",controller:"PassStrengthController"}),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let Q=(window.awr||{}).Q,$=$import("window:jQuery");$export("controller:PassStrengthController",["service:modal",function(modal){let scope=this;scope.$fn({showPasswordTip(){scope.$preventDefault(),modal.$enter("passwordInfo")}}),scope.$ready(_=>{$(scope.$getDom()).addClass("pass-strength-parent")}),scope.$addRecompileListener(_=>{$(scope.$getDom()).addClass("pass-strength-parent")}),scope.$getParent().$addValidationListener(v=>{let degree=0,degElements=$(scope.$getDom()).find(".pass-strength .deg");Q.$stringEqual(v.key,"password")&&($(degElements).addClass("on"),setTimeout(_=>{$(degElements).removeClass("on"),degree=function(str){let strongRegex=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})"),mediumRegex=new RegExp("^(((?=.*[a-z])(?=.*[A-Z]))|((?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Z])(?=.*[0-9])))(?=.{6,})");return strongRegex.test(str)&&str.length>=15?5:strongRegex.test(str)&&str.length>10?4:strongRegex.test(str)?3:mediumRegex.test(str)?2:1}(v.value),Q.$booleanTrue(v.isValid)||(degree=0),Q.$forEachIndex($(degElements),(el,idx)=>{idx<=degree&&$(el).addClass("on")})},150))})}]),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){(window.awr||{}).Q;$export("component:passwordInfo",{requires:[],template:"app/components/password-info/password-info.hbs",controller:"PasswordInfoController"}),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){(window.awr||{}).Q;$export("controller:PasswordInfoController",[function(){}]),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class ChangePasswordForm extends awr.Component{static get $require(){return{}}constructor(){super(ChangePasswordForm.$require),this.template="app/forms/change-password-form/change-password-form.hbs",this.controller="ChangePasswordForm"}}$export(ChangePasswordForm),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class ChangePasswordForm extends awr.Controller{static get $require(){return{formActivator:"service:formViewActivator",server:"service:serverCall",remoteConfig:"config:remoteConnectionConfig",router:"service:router"}}constructor(data,parent){super(ChangePasswordForm.$require,data,parent);let{formActivator:formActivator,server:server,remoteConfig:remoteConfig,router:router}=this,scope=this;this.changePasswordFormContext={},Object.defineProperty(this,"key",{get(){let state=router.$getCurrentState();return state&&state.params&&state.params.key?state.params.key:"none"}}),Object.defineProperty(this,"linkExpired",{get(){return Q.$objectExist(this.response)&&Q.$booleanFalse(this.response.reset_key_accepted)}}),formActivator.activate({scope:scope,form:"change-password-form",formInputSelector:".change-password-form input",beforeSetup(){},onSubmit:changePasswordFormContext=>(function({scope:scope,server:server,remoteConfig:remoteConfig,formData:formData,key:key}){return new Promise((resolve,reject)=>{setTimeout(_=>{server.$post({url:`${remoteConfig.serverURL}/xauth/password_reset`,data:{key:key,new_password:formData.password,password_confirm:formData.passwordConfirm},headers:{authorization:$import(`token:awr_app_token @decoder: base64:${remoteConfig.decoder}`)}}).then(res=>{scope.response=res,resolve(res)},err=>{err&&err.responseJSON&&(err=err.responseJSON),scope.response=err,reject(err)})},250)})})({scope:scope,server:server,remoteConfig:remoteConfig,formData:changePasswordFormContext,key:scope.key})}),scope.stepsValidation=[]}}$export(ChangePasswordForm),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class SignInForm extends awr.Component{static get $require(){return{}}constructor(){super(SignInForm.$require),this.template="app/forms/sign-in-form/sign-in-form.hbs",this.controller="SignInForm"}}$export(SignInForm),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class SignInForm extends awr.Controller{static get $require(){return{formActivator:"service:formViewActivator",authRedirector:"service:authRedirector",authService:"service:authService",router:"service:router"}}constructor(data,parent){super(SignInForm.$require,data,parent);let{formActivator:formActivator,authService:authService,authRedirector:authRedirector,router:router}=this,scope=this;this.signInFormContext={},formActivator.activate({scope:scope,form:"sign-in-form",formInputSelector:".sign-in-form input",beforeSetup(){},onSubmit:signInFormContext=>(function({scope:scope,authService:authService,authRedirector:authRedirector,router:router}){return new Promise((resolve,reject)=>{authService.signIn({email:scope.signInFormContext.email,password:scope.signInFormContext.password,remember:scope.signInFormContext.remember}).then(tokenUser=>{scope.signInBusy=!1,scope.signInFailed=!1,scope.signInError="",scope.auth={},setTimeout(_=>{router.$reloadCurrentState()},250),resolve("success")},error=>{scope.signInBusy=!1,scope.signInFailed=!0,scope.signInError=`${error}`,console.log(error),reject(error)})})})({scope:scope,authService:authService,authRedirector:authRedirector,router:router})}),this.stepsValidation=[]}}$export(SignInForm),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class SignUpForm extends awr.Component{static get $require(){return{}}constructor(){super(SignUpForm.$require),this.template="app/forms/sign-up-form/sign-up-form.hbs",this.controller="SignUpForm"}}$export(SignUpForm),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},$=(awr.Q,$import("window:jQuery"));class SignUpForm extends awr.Controller{static get $require(){return{formActivator:"service:formViewActivator",authRedirector:"service:authRedirector",authService:"service:authService",router:"service:router"}}constructor(data,parent){super(SignUpForm.$require,data,parent);let{formActivator:formActivator,authService:authService,authRedirector:authRedirector,router:router}=this,scope=this;this.signUpFormContext={},formActivator.activate({scope:scope,form:"sign-up-form",formInputSelector:".sign-up-form input",beforeSetup(){},onSubmit:signUpFormContext=>new Promise((resolve,reject)=>{authService.register(signUpFormContext).then(res=>{setTimeout(_=>{!function({scope:scope,authService:authService,authRedirector:authRedirector,router:router}){scope.signInBusy=!0,scope.signInFailed=!1,scope.signInError="",new Promise((resolve,reject)=>{authService.signIn({email:scope.signUpFormContext.email,password:scope.signUpFormContext.password,remember:!0}).then(tokenUser=>{scope.signInBusy=!1,scope.signInFailed=!1,scope.signInError="",scope.auth={},setTimeout(_=>{router.$reloadCurrentState()},250),resolve("success")},error=>{scope.signInBusy=!1,scope.signInFailed=!0,scope.signInError=`${error}`,console.log(error),reject(error)})})}({scope:scope,authRedirector:authRedirector,authService:authService,router:router})},500),resolve(res)},err=>{reject(err)})})}),this.stepsValidation=[],this.$addValidationListener(v=>{"acceptTerms"===v.key&&$(this.$getDom()).find(".terms-notice").toggleClass("hidden",v.isValid)},"sign-up-form-v-watcher")}}$export(SignUpForm),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;$import("window:jQuery");class AuthView extends awr.Controller{static get $require(){return{router:"service:router",superScope:"object:awr.superScope",authRedirector:"service:authRedirector",base64:"service:uriBase64"}}constructor(data,parent){super(AuthView.$require,data,parent);let{router:router,superScope:superScope,authRedirector:authRedirector,base64:base64}=this;Object.defineProperty(this,"isRedirect",{get:()=>Q.$objectExist(superScope.currentUser)}),Object.defineProperty(this,"isSignIn",{get(){return!this.isRedirect&&Q.$setContainsString(["default","signin"],this.$state.attrs.view)}}),Object.defineProperty(this,"isSignUp",{get(){return!(this.isRedirect||this.isSignIn)}}),this.$ready(_=>{if(!this.isRedirect)return;let next=this.$state.attrs.next;next=(next=Q.$stringExist(next)&&"default"!==next?base64.decode(next):"default").startsWith("#exit")||next.startsWith("/#exit")?"default":next,Q.$booleanTrue(superScope.currentUser.is_email_confirmed)?authRedirector.redirect(next):router.$go("email-confirm-view",{params:{},attrs:{next:base64.encode(next)}},!0)}),this.$init(_=>{window.scrollTo(0,0)})}changeView(name){this.$preventDefault();let{router:router}=this,state=this.$state;state.attrs.view="signup"===name?"signup":"signin",router.$go(state.name,state,!0)}}$export(AuthView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class Default extends awr.Route{static get $require(){return{}}constructor(){super(Default.$require),this.link="auth?:view&:next",this.template="app/views/auth-view/auth-view-index.hbs",this.controller="AuthView",this.defaults={params:{},attrs:{view:"default",next:"default"}},this.resolve={}}}$export(Default),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class EmailConfirmView extends awr.Controller{static get $require(){return{tokenSvc:"service:tokenService",remoteConnCnf:"config:remoteConnectionConfig",superScope:"object:awr.superScope",authRedirector:"service:authRedirector"}}constructor(data,parent){super(EmailConfirmView.$require,data,parent);let{remoteConnCnf:remoteConnCnf}=this;Object.defineProperty(this,"token",{get:()=>$import(`token:awr_app_token @decoder: base64:${remoteConnCnf.decoder}`)})}continueToNext(){this.$preventDefault();let{tokenSvc:tokenSvc,superScope:superScope,authRedirector:authRedirector,token:token}=this,next=this.$state.attrs.next&&"default"!==this.$state.attrs.next?(cmp=this.$state.attrs.next,$import("service:uriBase64").decode(cmp)):"default";var cmp;$(this.$getDom()).find(".just-confirmed").addClass("busy"),$(this.$getDom()).find(".just-confirmed").removeClass("has-note"),tokenSvc.getTokenUser(token).then(tokenUser=>{superScope.currentUser=tokenUser,setTimeout(_=>{$(this.$getDom()).find(".just-confirmed").removeClass("busy"),Q.$booleanTrue(tokenUser.is_email_confirmed)?authRedirector.redirect(next):($(this.$getDom()).find(".just-confirmed").addClass("has-note"),$(this.$getDom()).find(".just-confirmed .note .msg").text("According to our server your email is not yet confirmed!"))},500)},err=>{console.error(err),$(this.$getDom()).find(".just-confirmed").addClass("has-note"),$(this.$getDom()).find(".just-confirmed .note .msg").text("Something went wrong, please try again later!")}),setTimeout(_=>{$(this.$getDom()).find(".just-confirmed").removeClass("busy"),$(this.$getDom()).find(".just-confirmed").addClass("has-note")},2e3)}sendConfirmLink(){this.$preventDefault();let{tokenSvc:tokenSvc,token:token}=this;$(this.$getDom()).find(".send-again").addClass("busy"),$(this.$getDom()).find(".send-again").removeClass("has-note"),tokenSvc.newEmailConfirmLink(token).then(res=>{setTimeout(_=>{$(this.$getDom()).find(".send-again").removeClass("busy"),$(this.$getDom()).find(".send-again").addClass("has-note"),setTimeout(_=>{$(this.$getDom()).find(".send-again").removeClass("has-note")},3e4)},500)},err=>{console.error(err)})}}$export(EmailConfirmView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class EmailConfirmView extends awr.Route{static get $require(){return{}}constructor(){super(EmailConfirmView.$require),this.link="email-confirm?:next",this.template="app/views/email-confirm-view/email-confirm-view-index.hbs",this.controller="EmailConfirmView",this.defaults={params:{},attrs:{next:"default"}},this.resolve={}}}$export(EmailConfirmView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class ForgotPasswordView extends awr.Controller{static get $require(){return{formActivator:"service:formViewActivator",server:"service:serverCall",remoteConfig:"config:remoteConnectionConfig",router:"service:router"}}constructor(data,parent){super(ForgotPasswordView.$require,data,parent);let{formActivator:formActivator,server:server,remoteConfig:remoteConfig,router:router}=this,scope=this;this.badEmail=!1,formActivator.activate({scope:scope,form:"forgotPassword",formInputSelector:".forgot-password-view input",onSubmit:formData=>new Promise((resolve,reject)=>{setTimeout(_=>{server.$post({url:`${remoteConfig.serverURL}/xauth/password_reset_link`,data:{email:formData.email}}).then(res=>{scope.badEmail=!1,resolve("ok")},err=>{err&&err.responseJSON&&(err=err.responseJSON),scope.badEmail=err&&Q.$booleanFalse(err.email_found),reject("failed")})},250)})}),this.$addRecompileListener(_=>{scope.badEmail=!1})}signIn(){this.$preventDefault();let{router:router}=this;router.$go("default",{params:{},attrs:{view:"default",next:"default"}},!0)}}$export(ForgotPasswordView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class ForgotPasswordView extends awr.Route{static get $require(){return{}}constructor(){super(ForgotPasswordView.$require),this.link="forgot/password?",this.template="app/views/forgot-password-view/forgot-password-view-index.hbs",this.controller="ForgotPasswordView",this.defaults={params:{},attrs:{}},this.resolve={}}}$export(ForgotPasswordView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class ResetPasswordView extends awr.Controller{static get $require(){return{}}constructor(data,parent){super(ResetPasswordView.$require,data,parent)}}$export(ResetPasswordView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class ResetPasswordView extends awr.Route{static get $require(){return{}}constructor(){super(ResetPasswordView.$require),this.link="resets/password/:key?",this.template="app/views/reset-password-view/reset-password-view-index.hbs",this.controller="ResetPasswordView",this.defaults={params:{key:"none"},attrs:{}},this.resolve={isResetKeyValid:"passResetKeyCheck"}}}$export(ResetPasswordView),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let encoder="CmxldCBwYXJ0TGVuZ3RoID0gcGFyc2VJbnQoc3RyLmxlbmd0aCAvIDQpLCBhcnIgPSBbXSwKICAgICAgICBueHQsCiAgICAgICAgc3RhcnQgPSAwLAogICAgICAgIGVuZCA9IHBhcnRMZW5ndGgsCiAgICAgICAga2V5ID0gYnAgJiYgdHlwZW9mIGJwLmdlbmVyYXRlT25lID09PSAnZnVuY3Rpb24nID8gYnAuZ2VuZXJhdGVPbmUoKSA6IG51bGw7CiAgICBpZigha2V5KXsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGtleSA9IGtleS5zcGxpdCgnLScpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICBpZiAoaSA8IDMpIHsKICAgICAgICAgICAgbnh0ID0ga2V5W2ldK3dpbmRvdy5idG9hKHN0ci5zdWJzdHJpbmcoc3RhcnQsIGVuZCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG54dCA9IGtleVtpXSt3aW5kb3cuYnRvYShzdHIuc3Vic3RyaW5nKHN0YXJ0KSk7CiAgICAgICAgfQogICAgICAgIGFyci5wdXNoKG54dCk7CiAgICAgICAgc3RhcnQgPSBlbmQ7CiAgICAgICAgZW5kICs9IHBhcnRMZW5ndGg7CiAgICB9CiAgICByZXR1cm4gd2luZG93LmJ0b2EoSlNPTi5zdHJpbmdpZnkoYXJyLnJldmVyc2UoKSkpICsgJyRhV3QnOwo=",decoder="CiAgbGV0IGFyciA9IEpTT04ucGFyc2Uod2luZG93LmF0b2Ioc3RyLnN1YnN0cmluZygwLCBzdHIubGVuZ3RoIC0gNCkpKSwga2V5ID0gW107CiAgICBpZiAoIVEuJGFycmF5Tm90RW1wdHkoYXJyKSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgYXJyID0gYXJyLnJldmVyc2UoKTsKICAgIGFyciA9IFEuJG1hcChhcnIsIG54dCA9PiB7CiAgICAgICAga2V5LnB1c2gobnh0LnN1YnN0cmluZygwLCA0KSk7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5hdG9iKG54dC5zdWJzdHJpbmcoNCkpOwogICAgfSk7CiAgICBrZXkgPSBrZXkuam9pbignLScpOwogICAgaWYgKGJwICYmIHR5cGVvZiBicC5jaGVjayA9PT0gJ2Z1bmN0aW9uJyAmJiBicC5jaGVjayhrZXkpKSB7CiAgICAgICAgcmV0dXJuIGFyci5qb2luKCcnKTsKICAgIH0KICAgIHJldHVybiBudWxsOw==",awr=window.awr||{},Q=awr.Q,loc=window.location,serial=$import("service:serial"),currentUser=null,devServerPort=loc.host&&(loc.host.endsWith(":8080")||loc.host.endsWith(":9090")),hostname=devServerPort?loc.hostname:loc.host,server=$import("service:serverCall"),serverRoot=`${loc.protocol}//${hostname}`,api=`${serverRoot}/api`,authRoot=`${serverRoot}/xauth`,token=$import(`token:awr_app_token @decoder: base64:${decoder}`);class RemoteConnection extends awr.Config{static get $require(){return{}}constructor(name){super(RemoteConnection.$require,name);let blog_app_session,device_blog_app_session,remoteCnf=this;this.user=currentUser,this.apiURL=api,this.authURL=authRoot,this.serverURL=serverRoot,this.isGuest=!Q.$objectExist(currentUser),this.encoder=encoder,this.decoder=decoder,this.sessionIdTag="ba_session",this.deviceSessionIdTag="d_ba_session",this.isDevPort=devServerPort,blog_app_session=sessionStorage.getItem(this.sessionIdTag),device_blog_app_session=localStorage.getItem(this.deviceSessionIdTag),Q.$stringExist(blog_app_session)||sessionStorage.setItem(this.sessionIdTag,`${serial.basicPrime.generateOne()}@${(new Date).getTime()}`),Q.$stringExist(device_blog_app_session)||localStorage.setItem(this.deviceSessionIdTag,`${serial.basicPrime.generateOne()}@${(new Date).getTime()}`),Object.defineProperty(this,"sessionId",{get:()=>sessionStorage.getItem(remoteCnf.sessionIdTag)}),Object.defineProperty(this,"deviceSessionId",{get:()=>localStorage.getItem(remoteCnf.deviceSessionIdTag)})}}server.$get({url:`${authRoot}/token_user`,headers:{authorization:token}}).then(res=>{currentUser=res,$export(RemoteConnection)},err=>{console.error(err),$export(RemoteConnection)}),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class SocketConnection extends awr.Config{static get $require(){return{remoteCnf:"config:remoteConnection"}}constructor(name){super(SocketConnection.$require,name);let{remoteCnf:remoteCnf}=this,host=window.location.hostname;this.url=Q.$setContainsString(["www.pageshare.fi","pageshare.fi"],host)||host.indexOf("awiar.net")>0||host.indexOf("awiarsolutions.com")>0?`wss://${host}`:`ws://${host}:8890`,this.channels=["notification","hint@notification","broadcast@notification"],Object.defineProperty(this,"socketToken",{get:()=>(remoteCnf=$import("config:remoteConnectionConfig"))&&Q.$objectExist(remoteCnf.user)&&Q.$stringExist(remoteCnf.user.socket_token)?remoteCnf.user.socket_token:null})}}$export(SocketConnection),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},observerCount=(awr.Q,0);$import("class:Observable@event");class CollectionEvents extends awr.Observable{static get $require(){return{}}constructor(){super(CollectionEvents.$require)}makeSubscriber(){return observer=>{let observerId=`collection-events-observer-${++observerCount}`;return eventStr="collection:events",fn=(event=>{observer.next(event)}),listenerId=observerId,window.awr.$static.$on(eventStr,fn,listenerId),()=>{!function(eventStr,fn){window.awr.$static.$off(eventStr,fn)}("collection:events",observerId)}};var eventStr,fn,listenerId}}$export(CollectionEvents),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class PsDocEvents extends awr.ObservableTransform{static get $require(){return{socket:"observable:socket"}}constructor(){super(PsDocEvents.$require)}transform(){let{socket:socket}=this;return socket.$filter(event=>event&&Q.$stringExist(event.name)&&event.name.startsWith("ps-doc:"))}}$export(PsDocEvents),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class Collection extends awr.Model{static get $require(){return{}}constructor(){super(Collection.$require),this.url="/ps_collection/",this.headers={}}}$export(Collection),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class Doc extends awr.Model{static get $require(){return{}}constructor(){super(Doc.$require),this.url="/ps_doc/",this.headers={}}}$export(Doc),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class MyCollection extends awr.Model{static get $require(){return{}}constructor(){super(MyCollection.$require),this.url="/my_ps_collection/",this.headers={}}}$export(MyCollection),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class MyDoc extends awr.Model{static get $require(){return{}}constructor(){super(MyDoc.$require),this.url="/my_ps_doc/",this.headers={}}}$export(MyDoc),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class PsPublisher extends awr.Model{static get $require(){return{}}constructor(){super(PsPublisher.$require),this.url="/ps_publisher/",this.headers={}}}$export(PsPublisher),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class PsUser extends awr.Model{static get $require(){return{}}constructor(){super(PsUser.$require),this.url="/ps_user/",this.headers={}}}$export(PsUser),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class PublisherRole extends awr.Model{static get $require(){return{}}constructor(){super(PublisherRole.$require),this.url="/ps_publisher_role/",this.headers={}}}$export(PublisherRole),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class Role extends awr.Model{static get $require(){return{}}constructor(){super(Role.$require),this.url="/role/",this.headers={}}}$export(Role),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class TagSubscription extends awr.Model{static get $require(){return{}}constructor(){super(TagSubscription.$require),this.url="/tag_subscription/",this.headers={}}}$export(TagSubscription),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class BookImgSrc extends awr.Pipe{static get $require(){return{remoteCnf:"config:remoteConnectionConfig"}}constructor(){super(BookImgSrc.$require)}transform(img,...args){let{remoteCnf:remoteCnf}=this;return Q.$stringExist(img)?`${remoteCnf.serverURL}${img}`:Q.$objectExist(img)&&Q.$stringExist(img.src)?`${remoteCnf.serverURL}${img.src}`:""}}$export(BookImgSrc),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class Collections extends awr.Resolvable{static get $require(){return{collFetcher:"service:collectionFetcher"}}constructor(){super(Collections.$require),this.$importSuperScope()}resolve(state){return resolveFn(state,this,!1)}resolveLater(state){return resolveFn(state,this,!0)}}function resolveFn(state,self,network=!1){let{superScope:superScope,collFetcher:collFetcher}=self,loc=collFetcher.getLocalAll();return Q.$isEmpty(loc)?network?new Promise((resolve,reject)=>{collFetcher.findAll().then(res=>{superScope.cachedCollsReady=!0,resolve(Q.$asCollection(res))},err=>{console.error(err),reject(err)})}):(superScope.cachedCollsReady=!1,Promise.resolve(Q.$asCollection([]))):(superScope.cachedCollsReady=!0,Promise.resolve(loc))}$export(Collections),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,lastFromCache=!1;class CtrPublishers extends awr.Resolvable{static get $require(){return{model:"model:PsPublisher"}}constructor(){super(CtrPublishers.$require),this.$importSuperScope()}resolve(state){return resolveFn(state,this,!1)}resolveLater(state){return resolveFn(state,this,!0)}}function resolveFn(state,self,network=!1){let{superScope:superScope,model:model}=self,currentUser=superScope.currentUser;return Q.$objectExist(currentUser)?Q.$arrayExists(superScope.cachedPublishers)&&superScope.cachedPublishersReady?(lastFromCache=!0,Promise.resolve(superScope.cachedPublishers)):(lastFromCache=!1,network?new Promise((resolve,reject)=>{model.$findAll().then(res=>{superScope.cachedPublishersReady=!0,superScope.cachedPublishers=Q.$asCollection(res),resolve(Q.$asCollection(res))},err=>{console.error(err),reject(err)})}):(superScope.cachedPublishersReady=!1,Promise.resolve(Q.$asCollection([])))):(superScope.cachedPublishersReady=!0,Promise.resolve(Q.$asCollection([])))}$export(CtrPublishers),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class CtrTags extends awr.Resolvable{static get $require(){return{model:"model:TagSubscription"}}constructor(){super(CtrTags.$require),this.$importSuperScope()}resolve(state){return resolveFn(state,this,!1)}resolveLater(state){return resolveFn(state,this,!0)}}function resolveFn(state,self,network=!1){let{superScope:superScope,model:model}=self,currentUser=superScope.currentUser;return Q.$objectExist(currentUser)?Q.$arrayExists(superScope.cachedTags)&&superScope.cachedTagsReady?Promise.resolve(superScope.cachedTags):network?new Promise((resolve,reject)=>{model.$findAll().then(res=>{superScope.cachedTagsReady=!0,superScope.cachedTags=Q.$asCollection(res),resolve(Q.$asCollection(res))},err=>{console.error(err),reject(err)})}):(superScope.cachedTagsReady=!1,Promise.resolve(Q.$asCollection([]))):(superScope.cachedTagsReady=!1,Promise.resolve(Q.$asCollection([])))}$export(CtrTags),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,lastFromCache=!1;class CtrUsers extends awr.Resolvable{static get $require(){return{model:"model:PsUser"}}constructor(){super(CtrUsers.$require),this.$importSuperScope()}resolve(state){return resolveFn(state,this,!1)}resolveLater(state){return resolveFn(state,this,!0)}resolveRest(state){let currentUser=this.superScope.currentUser;return Q.$objectExist(currentUser)?lastFromCache?Promise.resolve([]):this.model.$findAll("?skip=40"):Promise.resolve(Q.$asCollection([]))}}function resolveFn(state,self,network=!1){let{superScope:superScope,model:model}=self,currentUser=superScope.currentUser;return Q.$objectExist(currentUser)?Q.$arrayExists(superScope.cachedUsers)&&superScope.cachedUsersReady?(lastFromCache=!0,Promise.resolve(superScope.cachedUsers)):(lastFromCache=!1,network?new Promise((resolve,reject)=>{model.$findAll("?take=40").then(res=>{superScope.cachedUsersReady=!0,superScope.cachedUsers=Q.$asCollection(res),resolve(Q.$asCollection(res))},err=>{console.error(err),reject(err)})}):(superScope.cachedUsersReady=!1,Promise.resolve(Q.$asCollection([])))):(superScope.cachedUsersReady=!1,Promise.resolve(Q.$asCollection([])))}$export(CtrUsers),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class Doc extends awr.Resolvable{static get $require(){return{docModel:"model:MyDoc",base64:"service:uriBase64"}}constructor(){super(Doc.$require)}resolve(state){return Promise.resolve({isPlaceholder:!0})}resolveLater(state){let{base64:base64,docModel:docModel}=this,docId=state.params.docId;return docModel.$findOne(base64.decode(docId))}}$export(Doc),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class MyCollections extends awr.Resolvable{static get $require(){return{model:"model:MyCollection"}}constructor(){super(MyCollections.$require),this.$importSuperScope()}resolve(state){return resolveFn(state,this,!1)}resolveLater(state){return resolveFn(state,this,!0)}}function resolveFn(state,self,network=!1){let{superScope:superScope,model:model}=self,currentUser=superScope.currentUser;return Q.$objectExist(currentUser)?Q.$arrayExists(superScope.cachedMyColls)&&superScope.cachedMyCollsReady?Promise.resolve(superScope.cachedMyColls):network?new Promise((resolve,reject)=>{model.$findAll().then(res=>{superScope.cachedMyCollsReady=!0,superScope.cachedMyColls=Q.$asCollection(res),resolve(Q.$asCollection(res))},err=>{console.error(err),reject(err)})}):(superScope.cachedMyCollsReady=!1,Promise.resolve(Q.$asCollection([]))):(superScope.cachedMyCollsReady=!1,Promise.resolve(Q.$asCollection([])))}$export(MyCollections),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class VDoc extends awr.Resolvable{static get $require(){return{docModel:"model:Doc",myDocModel:"model:MyDoc",base64:"service:uriBase64",collFetcher:"service:collectionFetcher"}}constructor(){super(VDoc.$require),this.$importSuperScope()}resolve(state){return resolveFn(state,this,!1)}resolveLater(state){return resolveFn(state,this,!0)}}function resolveFn(state,self,network=!1){let lsAll,model,currentColl,{base64:base64,docModel:docModel,myDocModel:myDocModel,collFetcher:collFetcher,superScope:superScope}=self,docId=state.params.docId;return network?(model=Q.$objectExist(superScope.currentUser)?myDocModel:docModel,Q.$stringExist(docId)&&"none"!==docId?model.$findOne(base64.decode(docId)):new Promise((resolve,reject)=>{collFetcher.findAll().then(res=>{currentColl=collFetcher.getCurrent(),Q.$objectExist(currentColl)&&!Q.$isEmpty(currentColl.stories)||(lsAll=collFetcher.getLocalAll(),currentColl=lsAll.$reduce(nxt=>!Q.$isEmpty(nxt.stories)).$first()),Q.$objectExist(currentColl)&&!Q.$isEmpty(currentColl.stories)||reject("Failed to load doc from default collection. No default Collection!"),collFetcher.setCurrent(currentColl.id),docId=Q.$isEmpty(currentColl.stories)?null:currentColl.stories[0].id,Q.$exist(docId)||reject("Failed to load doc from default collection. Bad docId for first collection member!"),model.$findOne(docId).then(doc=>{resolve(doc)},err=>{reject(err)})},err=>{reject(err)})})):Promise.resolve({isPlaceholder:!0})}$export(VDoc),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let Q=(window.awr||{}).Q;$export("service:appDemoAuthorizer",["service:serial",function(serial){let passRoots=["SRQP-2570","XHVJ-1329","KLBW-9305","CWKS-3480","ZQSN-6391","KQYL-8150","QMEO-1768","DAFW-1897","BFOT-4935","MHSR-8706"];return{authorize(a,b){let hasMatch=!1;return new Promise(function(resolve,reject){setTimeout(()=>{Q.$forEachIndex(passRoots,(val,index)=>{try{b=b.toUpperCase(),serial.basicPrime.generateOne({alpha:val.split("-")[0],delta:val.split("-")[1]}).endsWith(`${a}-${b}`)&&(hasMatch=!0)}catch(e){}}),Q.$booleanTrue(hasMatch)?resolve(!0):reject(!1)},1e3)})}}}]),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class AuthNextBuilder extends awr.Service{static get $require(){return{router:"service:router",remoteConfig:"config:remoteConnection"}}constructor(){super(AuthNextBuilder.$require)}getAppNextLink(){let{router:router}=this;return router.$getAppNextLink()}getCleanAuthNext(appNext){let{remoteConfig:remoteConfig,router:router}=this;return router.$makeAuthNext({connectionConfig:remoteConfig,appNext:appNext})}getURIEncoder(){let{router:router}=this;return router.$authNextEncoder}}$export(AuthNextBuilder),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;const cacheName="autocomplete@cache";class Autocomplete extends awr.Service{static get $require(){return{searchCache:"service:searchCache",server:"service:serverCall",remoteCnf:"config:remoteConnection"}}constructor(){super(Autocomplete.$require),Object.defineProperty(this,"superScope",{get:()=>$import("object:awr.superScope")})}search(query,{type:type=null,key:key=null,take:take=20}={}){let cachedResult,{server:server,remoteCnf:remoteCnf,superScope:superScope,searchCache:searchCache}=this,url=`${remoteCnf.serverURL}/api/ps_autocomplete?query=${encodeURIComponent(query)}`,devId=remoteCnf.deviceSessionId,user_id=Q.$objectExist(superScope.currentUser)?superScope.currentUser.id:null;return Q.$stringExist(query)?searchCache.inCache(cacheName,query)?($emit("search:autocomplete",{results:cachedResult=searchCache.getFromCache(cacheName,query),query:query}),cachedResult=Q.$asCollection(Q.$isEmpty(cachedResult)?[]:cachedResult),Promise.resolve(cachedResult)):(Q.$stringExist(type)&&(url+=`&type=${encodeURIComponent(type)}`),Q.$stringExist(key)&&(url+=`&key=${encodeURIComponent(key)}`),Q.$exist(user_id)&&(url+=`&user_id=${user_id}`),Q.$stringExist(devId)&&(url+=`&device_session_id=${devId}`),new Promise((resolve,reject)=>{server.$get({url:url}).then(res=>{let results=Q.$asCollection(Q.$isEmpty(res)?[]:res);Q.$numberExist(take)&&(results=results.$take(take)),searchCache.putInCache(cacheName,query,results),$emit("search:autocomplete",{results:results,query:query}),resolve(results)},err=>{console.error(err)})})):Promise.reject("no query!")}}$export(Autocomplete),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let cachedSet,current,cTime,freshCurrent,aggregated,onGoingCall,awr=window.awr||{},Q=awr.Q;class CollectionFetcher extends awr.Service{static get $require(){return{collModel:"model:Collection",myCollModel:"model:MyCollection",remoteCnf:"config:remoteConnection"}}constructor(){super(CollectionFetcher.$require);let{collModel:collModel}=this;Object.defineProperty(this,"superScope",{get:()=>$import("object:awr.superScope")}),aggregated=makeAggregatedCollection(collModel,Q.$asCollection([]))}findAll(query,refresh=null){let{collModel:collModel,myCollModel:myCollModel,superScope:superScope}=this,model=Q.$objectExist(superScope.currentUser)?myCollModel:collModel;return Q.$exist(refresh)||!Q.$booleanFalse(query)&&!Q.$booleanTrue(query)||(refresh=query,query=null),Q.$stringExist(query)?model.$findAll(query):(refresh=!(!Q.$booleanFalse(refresh)&&!Q.$booleanTrue(refresh))&&refresh,(Q.$booleanTrue(refresh)||!Q.$numberExist(cTime)||(new Date).getTime()>cTime+6e4)&&(cTime=null,cachedSet=null),Q.$isEmpty(cachedSet)?Q.$objectExists(onGoingCall)?onGoingCall:onGoingCall=new Promise((resolve,reject)=>{model.$findAll().then(res=>{onGoingCall=null,cachedSet=res,cTime=(new Date).getTime(),Q.$objectExist(current)&&(freshCurrent=res.$find(nxt=>nxt.id==current.id),current=Q.$objectExist(freshCurrent)?freshCurrent:null),resolve(res)},err=>{onGoingCall=null,console.error(err),reject(err)})}):Promise.resolve(cachedSet))}getLocalAll(){return Q.$isEmpty(cachedSet)?Q.$asCollection([]):Q.$asCollection(cachedSet)}getDocCollections(docId){return Q.$isEmpty(cachedSet)||!Q.$exist(docId)?Q.$asCollection([]):cachedSet.$reduce(nxt=>!Q.$isEmpty(nxt.stories)&&Q.$count(nxt.stories,nxtDoc=>nxtDoc.id==docId)>0)}removeDocFromCache(collId,docId){!Q.$isEmpty(cachedSet)&&Q.$exist(docId)&&cachedSet.$each(col=>{col.id===collId&&(col.stories=Q.$reduce(col.stories,nxt=>nxt.id!==docId))})}addDocIntoCache(collId,doc){!Q.$isEmpty(cachedSet)&&Q.$objectExist(doc)&&cachedSet.$each(col=>{col.id===collId&&(Q.$arrayExist(col.stories)||(col.stories=Q.$asCollection([])),Q.$count(col.stories,nxt=>nxt.id===doc.id)<1&&col.stories.push(doc))})}getOneLocal(cId){return"agr"===cId?aggregated:this.getLocalAll().$reduce(nxt=>Q.$numberExist(parseInt(nxt.id))&&parseInt(cId)===parseInt(nxt.id)).$first()}getCurrent(){let inCache,savedItemId=parseInt(sessionStorage.getItem("ps-cr-cl"));return Q.$objectExist(current)||!Q.$numberExist(savedItemId)||Q.$isEmpty(cachedSet)?Q.$objectExist(current)?current:Q.$isEmpty(cachedSet)?null:cachedSet.$first():(inCache=cachedSet.$find("id",savedItemId),Q.$objectExist(inCache)?inCache:cachedSet.$first())}setCurrent(id){let orig=current;return!("agr"!==id&&(Q.$isEmpty(cachedSet)||!Q.$exist(id)))&&(current="agr"===id?aggregated:cachedSet.$find("id",id),Q.$objectExist(current)?(sessionStorage.setItem("ps-cr-cl",id),$emit("collection:events",{name:"new-current",collection:current}),!0):(current=orig,!1))}aggregate(stories){let{collModel:collModel}=this;return(aggregated=makeAggregatedCollection(collModel,stories)).id}}function makeAggregatedCollection(model,stories){return model.$template({id:"agr",name:"aggregated",status:"published",user_id:"agr-user",type:"ps/collection",stories:stories})}$export(CollectionFetcher),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class FileUploader extends awr.Service{static get $require(){return{uploadManager:"service:uploadManager",remoteCnf:"config:remoteConnection"}}constructor(){super(FileUploader.$require)}upload({path:path,fileKey:fileKey,files:files}){let{uploadManager:uploadManager,remoteCnf:remoteCnf}=this;return uploadManager.upload({url:`${remoteCnf.serverURL}/${path}`,token:$import(`token:awr_app_token @decoder: base64:${remoteCnf.decoder}`),fileKey:fileKey,files:files})}}$export(FileUploader),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class GlobalFnHelper extends awr.Service{static get $require(){return{collectionFetcher:"service:collectionFetcher",base64:"service:uriBase64",modal:"service:modal"}}constructor(){super(GlobalFnHelper.$require)}firstDocDataInCollection(collId){let coll,docs,first,docTitle,docId,{base64:base64,modal:modal,collectionFetcher:collectionFetcher}=this;return new Promise((resolve,reject)=>{collectionFetcher.findAll().then(res=>{coll=res.$find("id",collId),docs=Q.$objectExist(coll)&&!Q.$isEmpty(coll.stories)?Q.$asCollection(coll.stories):Q.$asCollection([]),first=docs.$first(),Q.$objectExist(coll)&&collectionFetcher.setCurrent(coll.id),Q.$objectExist(first)?(docTitle=Q.$stringExist(first.title)?encodeURIComponent(first.title.toLowerCase().replace(/\s/g,"_")):"no_title",docId=base64.encode(first.id),resolve({docTitle:docTitle,docId:docId})):reject("empty")},err=>{reject(err)})})}findPrinciplesCollId(){let principles,{modal:modal,collectionFetcher:collectionFetcher}=this;return new Promise((resolve,reject)=>{collectionFetcher.findAll().then(res=>{principles=res.$reduce(nxt=>nxt.name&&"principles"===nxt.name.toLowerCase()).$first(),Q.$objectExist(principles)?resolve(principles.id):(modal.$enter("smallNotifModal",{icon:"fa fa-exclamation-triangle text-warning",message:"Sorry, Principles is not available at the moment. Please try again later",showRemove:!0}),reject("Principles not available"))},err=>{reject(err)})})}}$export(GlobalFnHelper),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;const cacheName="doc-search@cache";class PsDocSearch extends awr.Service{static get $require(){return{searchCache:"service:searchCache",server:"service:serverCall",remoteCnf:"config:remoteConnection"}}constructor(){super(PsDocSearch.$require),Object.defineProperty(this,"superScope",{get:()=>$import("object:awr.superScope")})}search(query,{type:type=null,key:key=null,take:take=20}={}){let cachedResult,{server:server,remoteCnf:remoteCnf,superScope:superScope,searchCache:searchCache}=this,url=`${remoteCnf.serverURL}/api/ps_story_search?query=${encodeURIComponent(query)}`,devId=remoteCnf.deviceSessionId,user_id=Q.$objectExist(superScope.currentUser)?superScope.currentUser.id:null;return Q.$stringExist(query)?searchCache.inCache(cacheName,query)?($emit("search:ps-doc",{results:cachedResult=searchCache.getFromCache(cacheName,query),query:query}),cachedResult=Q.$asCollection(Q.$isEmpty(cachedResult)?[]:cachedResult),Promise.resolve(cachedResult)):(Q.$stringExist(type)&&(url+=`&type=${encodeURIComponent(type)}`),Q.$stringExist(key)&&(url+=`&key=${encodeURIComponent(key)}`),Q.$exist(user_id)&&(url+=`&user_id=${user_id}`),Q.$stringExist(devId)&&(url+=`&device_session_id=${devId}`),new Promise((resolve,reject)=>{server.$get({url:url}).then(res=>{let results=Q.$asCollection(Q.$isEmpty(res)?[]:res);Q.$numberExist(take)&&(results=results.$take(take)),searchCache.putInCache(cacheName,query,results),$emit("search:ps-doc",{results:results,query:query}),resolve(results)},err=>{console.error(err)})})):Promise.reject("no query!")}}$export(PsDocSearch),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;const adminRoleNames=["admin@pageshare","moderator","super"];class RoleHelper extends awr.Service{static get $require(){return{}}constructor(){super(RoleHelper.$require)}isAdminInPublisher(publisher,userId){return this.hasRoleInPublisher(publisher,userId,"publisher")||this.hasRoleInPublisher(publisher,userId,"moderator")}canOwnPersonalCollections(user){return!!Q.$objectExist(user)&&function(roles,options){let result=!1;if(Q.$isEmpty(roles)||Q.$isEmpty(options))return result;return Q.$each(options,nxt=>{hasRole(roles,nxt)&&(result=!0)}),result}(Q.$isEmpty(user.roles)?[]:user.roles,["author@pageshare","admin@pageshare","moderator","super"])}canEditDoc(user,doc,collection,publishers){return!!(Q.$objectExist(user)&&Q.$objectExist(doc)&&Q.$numberExist(parseInt(doc.user_id)))&&(parseInt(doc.user_id)===parseInt(user.id)||this.canEditDocsInCollection(user,collection,publishers))}canEditDocsInCollection(user,collection,publishers){if(!this.canCreateDocsInCollection(user,collection,publishers))return!1;let pub=Q.$reduce(publishers,nxt=>parseInt(nxt.id)===parseInt(collection.publisher_id)).$first();return this.hasRoleInPublisher(pub,user.id,"publisher")||this.hasRoleInPublisher(pub,user.id,"moderator")}canCreateDocsInCollection(user,collection,publishers){if(!(Q.$objectExist(user)&&Q.$objectExist(collection)&&Q.$numberExist(parseInt(collection.user_id))))return!1;if(parseInt(collection.user_id)===parseInt(user.id))return!0;if(!Q.$numberExist(parseInt(collection.publisher_id)))return!1;let pub=Q.$reduce(publishers,nxt=>parseInt(nxt.id)===parseInt(collection.publisher_id)).$first();return!!Q.$objectExist(pub)&&this.hasRoleInPublisher(pub,user.id,"any")}hasRoleInPublisher(publisher,userId,roleName){if(!(Q.$objectExist(publisher)&&Q.$exist(userId)&&Q.$stringExist(roleName)))return!1;let{moderators:moderators,creators:creators}=publisher,isModerator=!Q.$isEmpty(moderators)&&Q.$count(moderators,nxt=>Q.$idEqual(nxt.id,userId))>0,isCreator=!Q.$isEmpty(creators)&&Q.$count(creators,nxt=>Q.$idEqual(nxt.id,userId))>0,isPublisher=Q.$idEqual(publisher.user_id,userId);return"any"===(roleName=roleName.toLowerCase())?isPublisher||isModerator||isCreator:"moderator"===roleName?isModerator:"creator"===roleName?isCreator:isPublisher}hasPSAdminRoleOrHigher(user){return Q.$objectExist(user)&&!Q.$isEmpty(user.roles)&&Q.$count(user.roles,nxt=>nxt.name&&Q.$setContainsString(["super","admin@pageshare","moderator"],nxt.name.toLowerCase()))>0}isPSAdminOrHigher(scope,userId){return this.hasRole(scope,userId,"admin")||this.hasRole(scope,userId,"super")}hasRole(scope,userId,roleName){if(!Q.$stringExist(roleName)||!Q.$exist(userId))return!1;scope=Q.$objectExist(scope)?scope:{};let{publishers:publishers,users:users}=scope,roleFound=!1;return(!Q.$setContainsString(["moderator","publisher","creator"],roleName)||!Q.$isEmpty(publishers))&&("publisher"===roleName?roleFound=publishers.$count(nxt=>nxt&&Q.$idEqual(nxt.user_id,userId))>0:"moderator"===roleName?publishers.$each(nxt=>{!Q.$isEmpty(nxt.moderators)&&Q.$count(nxt.moderators,moder=>moder&&Q.$idEqual(moder.id,userId))&&(roleFound=!0)}):"creator"===roleName?publishers.$each(nxt=>{!Q.$isEmpty(nxt.creators)&&Q.$count(nxt.creators,creator=>creator&&Q.$idEqual(creator.id,userId))&&(roleFound=!0)}):Q.$isEmpty(users)||(roleName="admin"===roleName||"author"===roleName?`${roleName}@pageshare`:roleName,users.$each(nxtUsr=>{Q.$idEqual(nxtUsr.id,userId)&&hasRole(nxtUsr.roles,roleName)&&(roleFound=!0)})),"reader"===roleName||roleFound)}rolesInclude(user,roleName){return!!Q.$objectExist(user)&&hasRole(user.roles,roleName)}}function hasRole(roles,roleName){return!Q.$isEmpty(roles)&&Q.$stringExist(roleName)&&Q.$count(roles,r=>"admin@pageshare"===roleName?Q.$setContainsString(adminRoleNames,r.name):r&&r.name===roleName)>0}$export(RoleHelper),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let current,awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery"),savedVal=0,body="body";class ScrollDirection extends awr.Service{static get $require(){return{}}constructor(){super(ScrollDirection.$require)}start(superScope){$(window).on("scroll",event=>{Q.$booleanTrue(superScope.dontCheckTheScroll)||(current=$(window).scrollTop(),$(body).toggleClass("has-some-scroll",current>=10&&current<65),$(body).toggleClass("has-scroll",current>=65),current<savedVal?(savedVal=current,$(body).removeClass("down-scroll"),$(body).addClass("up-scroll")):current>savedVal&&current>=65&&(savedVal=current,$(body).removeClass("up-scroll"),$(body).addClass("down-scroll")))})}}$export(ScrollDirection),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,cache={};class SearchCache extends awr.Service{static get $require(){return{}}constructor(){super(SearchCache.$require)}putInCache(cacheName,query,results){if(!Q.$stringExist(cacheName)||!Q.$stringExist(query))return!1;createCacheIfNotExists(cacheName);let queryCache=cache[cacheName];(queryCache=Q.$reduce(queryCache,nxt=>!(Q.$stringEqual(nxt.query,query)||nxt.expires.getTime()<=(new Date).getTime()))).push({query:query,expires:new Date((new Date).getTime()+6e4),results:results}),queryCache=Q.$descendingDate(queryCache,"expires"),queryCache=Q.$limit(queryCache,200),cache[cacheName]=queryCache}inCache(cacheName,query){if(!Q.$stringExist(cacheName)||!Q.$stringExist(query))return!1;createCacheIfNotExists(cacheName);let queryCache=cache[cacheName];return queryCache=Q.$reduce(queryCache,nxt=>nxt.expires.getTime()>(new Date).getTime()),Q.$count(queryCache,nxt=>Q.$stringEqual(nxt.query,query))>0}getFromCache(cacheName,query){if(!Q.$stringExist(cacheName)||!Q.$stringExist(query))return Q.$asCollection([]);createCacheIfNotExists(cacheName);let queryCache=cache[cacheName];return this.inCache(cacheName,query)?Q.$collect(queryCache,(collected,nxt)=>Q.$stringEqual(nxt.query,query)?nxt.results:collected):null}}function createCacheIfNotExists(cacheName){cache.hasOwnProperty(cacheName)&&Q.$arrayNotEmpty(cache[cacheName])||(cache[cacheName]=Q.$asCollection([]))}$export(SearchCache),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;const cacheName="saerch@cache";class Search extends awr.Service{static get $require(){return{searchCache:"service:searchCache",server:"service:serverCall",remoteCnf:"config:remoteConnection"}}constructor(){super(Search.$require),Object.defineProperty(this,"superScope",{get:()=>$import("object:awr.superScope")})}search(query,limit,target){let cachedResult,{server:server,remoteCnf:remoteCnf,superScope:superScope,searchCache:searchCache}=this,user_id=Q.$objectExist(superScope.currentUser)?superScope.currentUser.id:null,devId=remoteCnf.deviceSessionId,url=`${remoteCnf.serverURL}/api/search?query=${encodeURIComponent(query)}`;return Q.$stringExist(query)?limit<15&&searchCache.inCache(cacheName,query)?($emit("search:story-search",{results:cachedResult=searchCache.getFromCache(cacheName,query),query:query,target:target}),Promise.resolve({results:cachedResult,query:query})):(Q.$exist(limit)&&(url+=`&limit=${limit}`),Q.$exist(user_id)&&(url+=`&user_id=${user_id}`),Q.$stringExist(devId)&&(url+=`&device_session_id=${devId}`),new Promise((resolve,reject)=>{server.$get({url:url}).then(res=>{let results={stories:Q.$asCollection(res&&Q.$arrayNotEmpty(res.stories)?res.stories:[]).$map(nxt=>(nxt.resultType="story",nxt)),profiles:Q.$asCollection(res&&Q.$arrayNotEmpty(res.profiles)?res.profiles:[]).$map(nxt=>(nxt.resultType="profile",nxt))};$emit("search:story-search",{results:results,query:query,target:target}),resolve({items:results,query:query}),limit<15&&searchCache.putInCache(cacheName,query,res)},err=>{console.error(err)})})):Promise.reject("no query!")}}$export(Search),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class ShelfViewUpdater extends awr.Service{static get $require(){return{collFetcher:"service:collectionFetcher",remoteCnf:"config:remoteConnectionConfig",router:"service:router",roleHelper:"service:roleHelper",myDocModel:"model:MyDoc",docModel:"model:Doc"}}constructor(){super(ShelfViewUpdater.$require),Object.defineProperty(this,"superScope",{get:()=>$import("object:awr.superScope")})}update(scope){let{collFetcher:collFetcher,remoteCnf:remoteCnf,roleHelper:roleHelper,router:router,superScope:superScope}=this;!function({scope:scope,collFetcher:collFetcher,router:router,roleHelper:roleHelper,remoteCnf:remoteCnf,superScope:superScope}){(async function({collFetcher:collFetcher,superScope:superScope,router:router}){let current=collFetcher.getCurrent(),pubResolvable=$import("resolvable:ctrPublishers"),collections=current&&"agr"===current.id?Q.$asCollection([]):await collFetcher.findAll(),publishers=await pubResolvable.resolve(router.$getCurrentState());return superScope.cachedPublishers=publishers,{collections:collections,publishers:publishers,currentCollection:collFetcher.getCurrent(),currentUser:superScope.currentUser}})({collFetcher:collFetcher,superScope:superScope,router:router}).then(({collections:collections,publishers:publishers,currentCollection:currentCollection,currentUser:currentUser})=>{delete scope.canUserCreateDocs,Object.defineProperty(scope,"canUserCreateDocs",{get:()=>(!Q.$objectExist(currentCollection)||"agr"!==currentCollection.id)&&roleHelper.canCreateDocsInCollection(currentUser,currentCollection,publishers),configurable:!0}),Q.$objectExist(currentCollection)&&("agr"!==currentCollection.id&&Q.$objectExist(scope.coll)&&currentCollection.id===scope.coll.id||(setScopeItems(scope,collFetcher.getCurrent(),remoteCnf,superScope),scope.$recompile()))},err=>{})}({scope:scope,collFetcher:collFetcher,router:router,remoteCnf:remoteCnf,roleHelper:roleHelper,superScope:superScope})}setScopeItems(scope,coll){let{superScope:superScope,remoteCnf:remoteCnf}=this;setScopeItems(scope,coll,remoteCnf,superScope)}addItem(scope,itemId){let{myDocModel:myDocModel,docModel:docModel,superScope:superScope,collFetcher:collFetcher,remoteCnf:remoteCnf}=this;(Q.$objectExist(superScope.currentUser)?myDocModel:docModel).$findOne(itemId).then(docInstance=>{collFetcher.addDocIntoCache(scope.coll.id,docInstance),Q.$count(scope.coll.stories,nd=>nd.id===docInstance.id)<1&&scope.coll.stories.push(docInstance),setScopeItems(scope,scope.coll,remoteCnf,superScope),scope.$append({selector:".shelf .inner .s-items",segment:"shelfItem",dataContext:docInstance})},err=>{console.error(err)})}removeItem(scope,itemId){if(!Q.$numberExist(parseInt(itemId)))return;itemId=parseInt(itemId);let{collFetcher:collFetcher,remoteCnf:remoteCnf,superScope:superScope}=this;scope.coll.stories=scope.coll.stories.$reduce(nxt=>nxt.id!==itemId),collFetcher.removeDocFromCache(scope.coll.id,itemId),setScopeItems(scope,scope.coll,remoteCnf,superScope),scope.$getAllSegments().$each(nxt=>{parseInt(nxt.dataContext.id)===itemId&&nxt.$remove()})}removeItemIfNotAvailable(scope,itemId){if(!Q.$exist(itemId))return;let{myDocModel:myDocModel,docModel:docModel,superScope:superScope}=this;(Q.$objectExist(superScope.currentUser)?myDocModel:docModel).$findOne(itemId).then(docInstance=>{},err=>{this.removeItem(scope,itemId)})}handleItemBusyModes(scope,event){let{collFetcher:collFetcher,remoteCnf:remoteCnf,superScope:superScope}=this,item=$(scope.$getDom()).find(`.shelf-item[data-doc-id="${event.target_id}"]`);Q.$isEmpty(item)||scope.inControls||(event.name.endsWith("start-processing")?($(item).removeClass("loading"),$(item).addClass("processing")):event.name.endsWith("end-processing")&&($(item).removeClass("processing"),scope.coll.stories=Q.$map(scope.coll.stories,nxt=>nxt.id==event.target_id?(event.target.is_busy=!1,event.target):nxt),setScopeItems(scope,scope.coll,remoteCnf,superScope),scope.$getAllSegments().$each(nxt=>{parseInt(nxt.dataContext.id)===parseInt(event.target_id)&&nxt.$upgrade(event.target)})))}}function setScopeItems(scope,coll,remoteCnf,superScope){if(!Q.$objectExist(coll))return scope.coll={},void(scope.stories=Q.$asCollection([]));scope.coll=coll,scope.stories=Q.$isEmpty(coll.stories)?Q.$asCollection([]):Q.$asCollection(coll.stories).$map(nxt=>(nxt.isSelected=Q.$objectExist(superScope.currentDoc)&&nxt.id==superScope.currentDoc.id,nxt))}$export(ShelfViewUpdater),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class TokenService extends awr.Service{static get $require(){return{remoteConnCnf:"config:remoteConnection",server:"service:serverCall"}}constructor(){super(TokenService.$require)}getNewAccessToken(username,password){let appGroup,{remoteConnCnf:remoteConnCnf,server:server}=this;return Q.$numberExist(password)&&(password=`${password}`),Q.$stringExist(username)&&Q.$stringExist(password)?(appGroup=$('meta[name="awr-app-group"]').first(),server.$post({url:`${remoteConnCnf.authURL}/token`,data:{app_group:Q.$arrayNotEmpty(appGroup)?$(appGroup).attr("content"):"default",grant_type:"password",username:username,password:password,scope:"*"}})):Promise.reject("Bad credentials")}newEmailConfirmLink(token){if(!Q.$stringExist(token))return Promise.reject("Get token user: Bad token!");let{remoteConnCnf:remoteConnCnf,server:server}=this;return server.$post({url:`${remoteConnCnf.serverURL}/api/email_confirm_link`,headers:{authorization:token}})}destroyToken(token){let{remoteConnCnf:remoteConnCnf,server:server}=this;return Q.$stringExist(token)?server.$delete({url:`${remoteConnCnf.authURL}/token`,headers:{authorization:token}}):Promise.reject("Destroy token: Bad token!")}getTokenUser(token){let{remoteConnCnf:remoteConnCnf,server:server}=this;return Q.$stringExist(token)?server.$get({url:`${remoteConnCnf.authURL}/token_user`,headers:{authorization:token}}):Promise.reject("Get token user: Bad token!")}exchangeToken(exchange){let{remoteConnCnf:remoteConnCnf,server:server}=this;return server.$post({url:`${remoteConnCnf.serverURL}/xauth/token_exchange`,data:{key:exchange}})}}$export(TokenService),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class ConfirmModal extends awr.Component{static get $require(){return{}}constructor(){super(ConfirmModal.$require),this.controller="ConfirmModal",this.template="app/shared/components/confirm-modal/confirm-modal.hbs",this.scope={}}}$export(ConfirmModal),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class ConfirmModal extends awr.Controller{static get $require(){return{}}constructor(data,parent){super(ConfirmModal.$require,data,parent);let parentScope=this.$getParent(),{title:title,message:message,confirmText:confirmText,cancelText:cancelText,confirmBtnClass:confirmBtnClass,cancelBtnClass:cancelBtnClass,confirmBeforeIcon:confirmBeforeIcon,confirmAfterIcon:confirmAfterIcon,mainIcon:mainIcon,onConfirm:onConfirm,icon:icon}=Q.$objectExist(parentScope.scopeBody)?parentScope.scopeBody:{};this.body={icon:icon,title:title,message:message,confirmText:confirmText,cancelText:cancelText,confirmBtnClass:confirmBtnClass,cancelBtnClass:cancelBtnClass,confirmBeforeIcon:confirmBeforeIcon,confirmAfterIcon:confirmAfterIcon,mainIcon:mainIcon,onConfirm:onConfirm},Q.$stringExist(cancelText)||(this.body.cancelBtnClass="hidden")}confirm(){this.$preventDefault();let{onConfirm:onConfirm}=this.body;if(this.$getParent().modalOff(),Q.$functionExist(onConfirm))try{onConfirm()}catch(e){console.error("Confirm Error: onConfirm callback ended by an error."),console.error(e)}}cancel(){this.$preventDefault(),this.$getParent().modalOff()}}$export(ConfirmModal),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class CookieBanner extends awr.Component{static get $require(){return{}}constructor(){super(CookieBanner.$require),this.template="app/shared/components/cookie-banner/cookie-banner.hbs",this.controller="CookieBanner"}}$export(CookieBanner),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");const cookiePolicyKeyPrefix="ps_acp_";class CookieBanner extends awr.Controller{static get $require(){return{remoteCnf:"config:remoteConnectionConfig",superScope:"object:awr.superScope",base64:"service:uriBase64"}}constructor(data,parent){super(CookieBanner.$require,data,parent);let status,{superScope:superScope,base64:base64}=this;this.$init(_=>{status=function(user,base64){return localStorage.getItem(`${cookiePolicyKeyPrefix}${Q.$exists(user)?base64.encode(user.id).toLowerCase():"null"}`)}(superScope.currentUser,base64),$(this.$getDom()).find(".cookie-banner").toggleClass("on",!(Q.$stringExists(status)&&"true"===status))})}accept(){let{superScope:superScope,base64:base64}=this;!function(user,base64){localStorage.setItem(`${cookiePolicyKeyPrefix}${Q.$exists(user)?base64.encode(user.id).toLowerCase():"null"}`,"true")}(superScope.currentUser,base64)}}$export(CookieBanner),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class DocMenu extends awr.Component{static get $require(){return{}}constructor(){super(DocMenu.$require),this.controller="DocMenu",this.template="app/shared/components/doc-menu/doc-menu.hbs",this.scope={currentDoc:"="}}}$export(DocMenu),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,labels=($import("window:jQuery"),["collections","languages","authors","categories","year"]);class DocMenu extends awr.Controller{static get $require(){return{collFetcher:"service:collectionFetcher",superScope:"object:awr.superScope",roleHelper:"service:roleHelper",docSearch:"service:psDocSearch"}}constructor(data,parent){super(DocMenu.$require,data,parent);let{collFetcher:collFetcher,superScope:superScope,roleHelper:roleHelper}=this,scope=this;setupScopeItems(scope,labels,collFetcher,superScope),Object.defineProperty(this,"userCanEditDoc",{get(){if(!Q.$objectExist(superScope.currentDoc))return!1;let coll=collFetcher.getDocCollections(superScope.currentDoc.id);return coll=Q.$isEmpty(coll)?null:coll[0],roleHelper.canEditDoc(superScope.currentUser,superScope.currentDoc,coll,superScope.cachedPublishers||Q.$asCollection([]))}}),scope.$bind("observable:collectionEvents",{onEvent(event,preventDefault){preventDefault(),"new-doc-selected"===event.name&&(setupScopeItems(scope,labels,collFetcher,superScope),scope.$recompile())}})}handle(group,searchId,value){this.$preventDefault();let agrId,{docSearch:docSearch,collFetcher:collFetcher}=this;"collections"!==group&&docSearch.search(searchId).then(stories=>{agrId=collFetcher.aggregate(stories),collFetcher.setCurrent(agrId)},err=>{console.error(err)})}}function setupScopeItems(scope,groups,collFetcher,superScope){let currentDoc=superScope.currentDoc;groups=Q.$isEmpty(groups)?Q.$asCollection([]):Q.$asCollection(groups),Q.$objectExist(currentDoc)?(scope.docId=currentDoc.id,scope.items=Q.$asCollection(groups).$map(nxtGrp=>{let values=Q.$asCollection([]);return currentDoc.meta=Q.$isEmpty(currentDoc.meta)?Q.$asCollection([]):Q.$asCollection(currentDoc.meta),values="collections"===nxtGrp?collFetcher.getDocCollections(currentDoc.id).$map(nxtC=>(nxtC.value=nxtC.name,nxtC.searchId=nxtC.id,nxtC)):groups.$reduce(nxtG=>"collections"!==nxtG&&nxtG===nxtGrp).$map(nxtG=>currentDoc.meta.$reduce(nxtM=>nxtM.key===nxtGrp).$map(nxtM=>({value:Q.$setContainsString(["authors","languages"],nxtM)?Q.$capitalizeName(nxtM.value):nxtM.value,searchId:nxtM.value}))).$flatten(),{icon:getIcon(nxtGrp),group:nxtGrp,label:"year"===nxtGrp?"Year of publication":Q.$capitalizeFirstLetter(nxtGrp)+":",values:values}}).$reduce(nxt=>!Q.$isEmpty(nxt.values)),Q.$isEmpty(currentDoc.tags)||scope.items.push({icon:getIcon("categories"),group:"tags",label:"Tags",values:Q.$map(currentDoc.tags,nxt=>({value:nxt.name,searchId:nxt.name}))})):scope.items=Q.$asCollection([])}function getIcon(group){let gr=group.toLowerCase();return"collections"===gr?"fas fa-sitemap":"authors"===gr?"fas fa-pen-nib":"year"===gr?"fas fa-calendar":"categories"===gr?"fas fa-hashtag":"languages"===gr?"fas fa-globe":""}$export(DocMenu),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class MainMenu extends awr.Component{static get $require(){return{}}constructor(){super(MainMenu.$require),this.controller="MainMenu",this.template="app/shared/components/main-menu/main-menu.hbs",this.scope={}}}$export(MainMenu),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class MainMenu extends awr.Controller{static get $require(){return{superScope:"object:awr.superScope",remoteCnf:"config:remoteConnectionConfig",roleHelper:"service:roleHelper"}}constructor(data,parent){super(MainMenu.$require,data,parent);let{superScope:superScope,remoteCnf:remoteCnf}=this,scope=this;scope.$importProperty("currentUser"),Object.defineProperty(this,"publishers",{get:()=>Q.$asCollection(Q.$arrayExists(superScope.cachedPublishers)?superScope.cachedPublishers:[])}),setupMenuItems(scope),scope.$bind("observable:authEvents",{onEvent(event,preventDefault){preventDefault(),Q.$objectExist(event)&&Q.$setContainsString(["sign-in","sign-out"],event.type)&&("sign-in"===event.type?(scope.currentUser=event.user,setupMenuItems(scope)):"sign-out"===event.type&&(scope.currentUser=null,setupMenuItems(scope)),setTimeout(_=>{scope.$recompile()},0))}})}toggleMenu(){this.$preventDefault();let menu=$(this.$getDom()).find(".main-menu-expand"),toggle=$(this.$getDom()).find(".main-menu.menu-toggle");$(menu).animate({width:"toggle"},165,function(){$(menu).hasClass("on")?($(menu).removeClass("on"),$(toggle).removeClass("open")):($(menu).addClass("on"),$(toggle).addClass("open"))})}action(id){this.$preventDefault();let collsGroup,{superScope:superScope}=this;Q.$setContainsString(["signIn","signUp"],id)?Q.$functionExist(superScope.redirectToAuth)&&superScope.redirectToAuth.call(superScope,id):"scrollTop"===id?superScope.scrollToTop():"myShelf"===id?superScope.openMyShelf():"myCollections"===id?superScope.openMyCollections():"principles"===id?superScope.openPrinciples():"github"===id?window.open("https://github.com/Pageprism/pageprism","_blank"):"controls"===id?superScope.openControls():"colls"===id&&(collsGroup=$(this.$getDom()).find(".mv-item-container.colls-parent"),$(collsGroup).toggleClass("open",!$(collsGroup).hasClass("open")))}}function setupMenuItems(scope){let{superScope:superScope,roleHelper:roleHelper}=scope;scope.items=Q.$asCollection([{name:"Scroll to top",id:"scrollTop",icon:"fa fa-arrow-circle-up",class:"scroll-top"},{name:"Code",id:"github",icon:"fab fa-github"},{name:"principles",id:"principles",icon:"far fa-lightbulb"},{name:"collections",id:"colls",icon:"fa fa-sitemap",isCollections:!0},{name:"Sign in",id:"signIn",icon:"fas fa-sign-in-alt"},{name:"Register",id:"signUp",icon:"fas fa-user-plus"},{name:"My Shelf",id:"myShelf",icon:"fa fa-book-open"},{name:"My Collections",id:"myCollections",icon:"fas fa-boxes"},{name:"Controls",id:"controls",icon:"fa fa-wrench"}]),Q.$objectExist(scope.currentUser)?(scope.items=scope.items.$reduce(nxt=>!Q.$setContainsString(["signIn","signUp"],nxt.id)),roleHelper.canOwnPersonalCollections(scope.currentUser)||roleHelper.hasRole(scope,scope.currentUser.id,"creator")||roleHelper.hasRole(scope,scope.currentUser.id,"moderator")||roleHelper.hasRole(scope,scope.currentUser.id,"publisher")||(scope.items=scope.items.$reduce(nxt=>!Q.$setContainsString(["myShelf"],nxt.id)))):scope.items=scope.items.$reduce(nxt=>!Q.$setContainsString(["controls","myShelf","myCollections"],nxt.id))}$export(MainMenu),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class MenuCollections extends awr.Component{static get $require(){return{}}constructor(){super(MenuCollections.$require),this.controller="MenuCollections",this.template="app/shared/components/menu-collections/menu-collections.hbs",this.scope={}}}$export(MenuCollections),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class MenuCollections extends awr.Controller{static get $require(){return{collFetcher:"service:collectionFetcher",superScope:"object:awr.superScope",router:"service:router"}}constructor(data,parent){super(MenuCollections.$require,data,parent);let{collFetcher:collFetcher,superScope:superScope,router:router,screen:screen}=this,scope=this;updateView(scope,collFetcher,!1,!1),this.$bind("observable:collectionEvents",{onEvent(event,preventDefault){preventDefault(),"new-current"===event.name&&updateView(scope,collFetcher,!1,!1)}}),this.$bind("model:MyCollection",{onEvent(event,preventDefault){preventDefault(),Q.$setContainsString(["remove","create","save"],event.requestType)&&updateView(scope,collFetcher,!0,!0)}}),this.$init(_=>{let bodyHeight=$("body").height(),maxHeight=Math.min(600,Math.max(200,bodyHeight-238));$(this.$getDom()).find(".item-container").css("maxHeight",`${maxHeight}px`)})}openCollection(event,collId){this.$preventDefault();let{superScope:superScope}=this;$(this.$getDom()).find(".coll-item").removeClass("selected"),$(this.$getDom()).find(`.coll-item[data-cl-id='${collId}']`).addClass("selected"),superScope.openCollection(collId)}editColls(){this.$preventDefault();let{router:router}=this;router.$go("my-collections-view",{params:{cId:"index"},attrs:{}},!0)}}function updateView(scope,collFetcher,refresh=!1,isSave=!1){let cr,newHash,now,time=(new Date).getTime()+500;scope.colls=Q.$asCollection([]),collFetcher.findAll(refresh).then(res=>{scope.colls=res.$map(nxt=>(cr=collFetcher.getCurrent(),nxt.isCurrent=cr&&Q.$idEqual(cr.id,nxt.id),nxt)).$reduce(nxt=>nxt.name&&"principles"!==nxt.name.toLowerCase()),newHash=scope.colls.map(nxt=>nxt.id).join("-"),!isSave&&Q.$stringExist(newHash)&&scope.hash===newHash||(scope.hash=newHash,(now=(new Date).getTime())<time?setTimeout(_=>{scope.$recompile()},500):scope.$recompile())},err=>{})}$export(MenuCollections),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class PrivacyPolicyModal extends awr.Component{static get $require(){return{}}constructor(){super(PrivacyPolicyModal.$require),this.template="app/shared/components/privacy-policy-modal/privacy-policy-modal.hbs",this.controller="PrivacyPolicyModal"}}$export(PrivacyPolicyModal),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},$=(awr.Q,$import("window:jQuery"));class PrivacyPolicyModal extends awr.Controller{static get $require(){return{modal:"service:modal",superScope:"object:awr.superScope"}}constructor(data,parent){super(PrivacyPolicyModal.$require,data,parent);this.$disableDefaultActionAutoRecompile()}agree(){let{modal:modal,superScope:superScope}=this;$(superScope.$getDom()).find('input[type="checkbox"]').each((idx,elem)=>{"acceptTerms"!==$(elem).attr("name")||$(elem).prop("checked")||$(elem).trigger("click")}),setTimeout(_=>{modal.$exit()},0)}}$export(PrivacyPolicyModal),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class PsHeader extends awr.Component{static get $require(){return{}}constructor(){super(PsHeader.$require),this.controller="PsHeader",this.template="app/shared/components/ps-header/ps-header.hbs",this.scope={}}}$export(PsHeader),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class PsHeader extends awr.Controller{static get $require(){return{superScope:"object:awr.superScope",router:"service:router"}}constructor(data,parent){super(PsHeader.$require,data,parent);let{superScope:superScope}=this,scope=this;scope.brandText=Q.$objectExist(superScope.currentDoc)&&Q.$stringExist(superScope.currentDoc.title)?superScope.currentDoc.title:"Pageshare",scope.hasDocMenu=Q.$objectExist(superScope.currentDoc),scope.$bind("observable:start@states@router",{onEvent(event,preventDefault){preventDefault(),scope.brandText="Pageshare",scope.hasDocMenu=!1,$(scope.$getDom()).find(".navbar-brand .text").text(scope.brandText),$(scope.$getDom()).find(".ps-header").toggleClass("has-doc-menu",scope.hasDocMenu)}}),scope.$bind("observable:collectionEvents",{onEvent(event,preventDefault){preventDefault(),"new-doc-selected"===event.name&&(event.doc&&Q.$stringExist(event.doc.title)?scope.brandText=event.doc.title:scope.brandText="Pageshare",scope.hasDocMenu=Q.$objectExist(superScope.currentDoc),$(scope.$getDom()).find(".navbar-brand .text").text(scope.brandText),$(scope.$getDom()).find(".ps-header").toggleClass("has-doc-menu",scope.hasDocMenu))}})}brandClick(){this.$preventDefault();let{router:router}=this;router.$goDefault()}toggleDocMenu(){this.$preventDefault();let menu=$(this.$getDom()).find(".ps-header .doc-menu"),parent=$(this.$getDom()).find(".ps-header");$(menu).animate({height:"toggle"},165,function(){$(parent).hasClass("doc-menu-open")?$(parent).removeClass("doc-menu-open"):$(parent).addClass("doc-menu-open")})}}$export(PsHeader),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class Shelf extends awr.Component{static get $require(){return{}}constructor(){super(Shelf.$require),this.controller="Shelf",this.template="app/shared/components/shelf/shelf.hbs",this.scope={}}}$export(Shelf),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class Shelf extends awr.Controller{static get $require(){return{remoteCnf:"config:remoteConnectionConfig",superScope:"object:awr.superScope",router:"service:router",viewUpdater:"service:shelfViewUpdater",psDocEvents:"observable:psDocEvents"}}constructor(data,parent){super(Shelf.$require,data,parent);let inControls,sectionName,{superScope:superScope,router:router,viewUpdater:viewUpdater,psDocEvents:psDocEvents}=this,scope=this,currentLeftScroll=0,ctrEnv=getCtrEnv(router.$getCurrentState());viewUpdater.setScopeItems(this,null),viewUpdater.update(this),this.isShelf=!0,this.inControls=ctrEnv.inControls,this.sectionName=ctrEnv.sectionName,this.cSections=[{name:"saved",id:"bookmarks",icon:"fas fa-bookmark"},{name:"tags",id:"tags",icon:"fas fa-hashtag"},{name:"users",id:"users",icon:"fas fa-user-friends"},{name:"My Publisher",id:"my-publisher",icon:"fas fa-cloud-upload-alt"},{name:"invite",id:"invite",icon:"fas fa-plus"}],inControls=this.inControls,sectionName=this.sectionName,this.$bind(psDocEvents,{onEvent(event,preventDefault){preventDefault(),Q.$setContainsString(["ps-doc:start-processing","ps-doc:end-processing"],event.name)?viewUpdater.handleItemBusyModes(scope,event):Q.$objectExist(event.target)&&Q.$objectExist(scope.coll)&&Q.$setContainsNumber(event.target.collection_membership,scope.coll.id)&&(docInShelf(scope,{modelInstance:event.target})||!event.name.endsWith("new")&&"ps-doc:publish"!==event.name?event.name.endsWith("remove")&&docInShelf(scope,{modelInstance:event.target})?viewUpdater.removeItem(scope,event.target_id):event.name.endsWith("unpublish")&&docInShelf(scope,{modelInstance:event.target})&&viewUpdater.removeItemIfNotAvailable(scope,event.target_id):(scope.coll.stories.push(event.target),viewUpdater.addItem(scope,event.target_id)))}}),this.$bind("observable:collectionEvents",{onEvent(event,preventDefault){preventDefault(),"new-current"===event.name?viewUpdater.update(scope):"new-doc-selected"!==event.name||Q.$isEmpty(scope.stories)||($(scope.$getDom()).find(".shelf-item").removeClass("selected"),Q.$objectExist(event.doc)&&scope.stories.$count(nxt=>event.doc&&nxt.id==event.doc.id)>0&&($(scope.$getDom()).find(`.shelf-item[data-doc-id='${event.doc.id}']`).addClass("selected"),viewUpdater.setScopeItems(scope,scope.coll)))}}),this.$bind("model:Collection",{onEvent(event,preventDefault){preventDefault(),scope.inControls||"findAll"===event.requestType&&viewUpdater.update(scope)}}),this.$bind("observable:start@states@router",{onEvent(event,preventDefault){preventDefault(),currentLeftScroll=$(this.$getDom()).find(".shelf").scrollLeft()}}),this.$bind("observable:success@states@router",{onEvent(event,preventDefault){preventDefault();let ctrEnv=getCtrEnv(event.to);inControls=ctrEnv.inControls,sectionName=ctrEnv.sectionName,(inControls||scope.inControls)&&(scope.inControls===inControls&&Q.$stringExist(scope.sectionName)&&scope.sectionName===sectionName||(scope.inControls=inControls,scope.sectionName=sectionName,scope.$recompile()))}}),this.$init(_=>{Q.$each(this.stories,nxt=>{let item=$(scope.$getDom()).find(`.shelf-item[data-doc-id="${nxt.id}"]`);Q.$booleanTrue(nxt.is_busy)&&($(item).removeClass("loading"),$(item).addClass("processing"))}),$(this.$getDom()).find(".shelf").scrollLeft(currentLeftScroll)}),this.$bind("observable:authEvents",{onEvent(event,preventDefault){preventDefault(),"sign-in"===event.type||"sign-out"===event.type&&$(scope.$getDom()).find(".shelf-item.add-doc").removeClass("on")}})}openCSection(id){this.$preventDefault();let{router:router}=this,state=router.$getCurrentState();"controls-view"===state.name&&state.params.section===id||Q.$setContainsString(["users","bookmarks","tags","invite","my-publisher"],id)&&router.$go(`${id}-view`,{params:{}},!0)}openDoc(docId,title){let{superScope:superScope}=this;this.$preventDefault(),Q.$exist(docId)&&($(this.$getDom()).find(".shelf-item").removeClass("selected"),$(this.$getDom()).find(`.shelf-item[data-doc-id='${docId}']`).addClass("selected"),superScope.openDoc(docId,title))}coverLoaded(docId){this.$preventDefault(),Q.$exist(docId)&&$(this.$getDom()).find(`.shelf-item[data-doc-id='${docId}']`).removeClass("loading")}}function getCtrEnv(state){let inControls=state&&Q.$setContainsString(["tags-view","users-view","bookmarks-view","invite-view","my-publisher-view"],state.name);return{inControls:inControls,sectionName:inControls?state.name.replace("-view",""):null}}function docInShelf(scope,event){return Q.$objectExist(event.modelInstance)&&!Q.$isEmpty(scope.stories)&&scope.stories.$count(nxt=>parseInt(nxt.id)===parseInt(event.modelInstance.id))>0}$export(Shelf),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class SmallNotifModal extends awr.Component{static get $require(){return{}}constructor(){super(SmallNotifModal.$require),this.controller="SmallNotifModal",this.template="app/shared/components/small-notif-modal/small-notif-modal.hbs",this.scope={}}}$export(SmallNotifModal),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class SmallNotifModal extends awr.Controller{static get $require(){return{}}constructor(data,parent){super(SmallNotifModal.$require,data,parent);let scope=this,parentScope=this.$getParent();scope.body=Q.$objectExist(parentScope.scopeBody)?parentScope.scopeBody:{},scope.$ready(_=>{let parentScopeReadyDom=$(scope.$getDom()).parent().parent();!scope.body.showRemove&&Q.$arrayNotEmpty(parentScopeReadyDom)&&$(parentScopeReadyDom).find("#awrModalRmBtn").addClass("hidden"),$(scope.$getDom()).find("p.msg-p").removeClass("hidden")})}}$export(SmallNotifModal),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class UserMenu extends awr.Component{static get $require(){return{}}constructor(){super(UserMenu.$require),this.controller="UserMenu",this.template="app/shared/components/user-menu/user-menu.hbs",this.scope={}}}$export(UserMenu),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q,$=$import("window:jQuery");class UserMenu extends awr.Controller{static get $require(){return{superScope:"object:awr.superScope",remoteCnf:"config:remoteConnectionConfig"}}constructor(data,parent){super(UserMenu.$require,data,parent);let{superScope:superScope,remoteCnf:remoteCnf}=this,scope=this;scope.$importProperty("currentUser"),setupScopeUser(scope),scope.$bind("observable:authEvents",{onEvent(event,preventDefault){preventDefault(),Q.$objectExist(event)&&Q.$setContainsString(["sign-in","sign-out"],event.type)&&("sign-in"===event.type?(scope.currentUser=event.user,setupScopeUser(scope)):"sign-out"===event.type&&(scope.currentUser=null,setupScopeUser(scope)),scope.$recompile())}})}toggleUserMenu(){this.$preventDefault();let menu=$(this.$getDom()).find(".user-menu-expand");$(menu).animate({height:"toggle"},165,function(){$(menu).hasClass("on")?$(menu).removeClass("on"):$(menu).addClass("on")})}}function setupScopeUser(scope){let current=scope.currentUser;Q.$objectExist(current)?(scope.user={},scope.user.fullName=Q.$capitalizeName(current.name),scope.user.nickname=Q.$stringExist(scope.user.fullName)?current.name.split(" ")[0]:"",scope.user.email=Q.$stringExist(current.email)?current.email:"",scope.user.isAdmin=!1,Q.$isEmpty(current.roles)||(scope.user.isAdmin=Q.$asCollection(current.roles).$count(nxt=>"admin@pageshare"===nxt.name)>0)):scope.user=null}$export(UserMenu),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{};awr.Q;class ShelfItem extends awr.Segment{static get $require(){return{}}constructor(){super(ShelfItem.$require),this.itemAs="item",this.template="app/shared/segments/shelf-item/shelf-item.hbs",this.bind="",this.bindOptions={}}setup(){}start(){}ready(){}}$export(ShelfItem),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){let awr=window.awr||{},Q=awr.Q;class Errors extends awr.Controller{static get $require(){return{superScope:"object:awr.superScope"}}constructor(data,parent){super(Errors.$require,data,parent);let{$state:$state,superScope:superScope}=this;this.code=$state.params.code,Q.$objectExist(superScope.currentUser)&&"e2"===this.code&&(this.code="404")}}$export(Errors),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){(window.awr||{}).Q;$import("service:router").$route({name:"errors-view",link:"errors/:code?",template:"app/shared/views/errors/errors_index.hbs",defaults:{params:{code:"404"},attrs:{}},resolve:{},controller:"ErrorsController"}),__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}(),function(){var __$$requires$$__=[];__pushToBootQueue__(function(){var global;(global=window).emptyTpls=global.emptyTpls||0,global.emptyTpls++,__callModuleMainFn__("function"==typeof $main?$main:null,__$$requires$$__)})}()}(window,jQuery);